<h1>Your Notifications</h1>

<% if (notifications.length === 0) { %>
  <p>You have no notifications at the moment.</p>
<% } else { %>
  <form method="POST" action="/notifications/mark-all-read">
    <button class="btn btn-secondary" type="submit">âœ… Mark All as Read</button>
  </form>

  <ul class="notification-list">
    <% notifications.forEach(note => { %>
      <li class="notification-item" id="notif-<%= note._id %>">
        <div class="notification-content">
          <p><%= note.message %></p>

          <% if (note.link && note.link.includes('/communities/')) { %>
            <a 
            href="<%= note.link %>?notif=<%= note._id %>"
            class="btn open-invite-modal"
            data-community-id="<%= note.link.split('/').pop() %>" 
            data-notification-id="<%= note._id %>"
            data-message="<%= note.message %>"
            data-link="<%= note.link %>">
              View Invite
            </a>
          <% } else if (note.link) { %>
            <% if (note.meta?.type === "join_request") { %>
              <a href="/communities/<%= note.meta.communityId %>/manage" class="btn">View Invite</a>
            <% } else { %>
              <a href="<%= note.link %>" class="btn">View</a>
            <% } %>
          <% } %>
        </div>
      </li>
    <% }) %>
  </ul>
<% } %>