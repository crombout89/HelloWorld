<title><%= title %></title>

<div class="page-title">
  <h1>Viewing <%= community.name %></h1>
  <p><strong>Members:</strong> <%= community.members.length %></p>
</div>

<% if (community.coverImage) { %>
  <img src="<%= community.coverImage %>" alt="Community Cover" class="community-cover">
<% } %>

<p><%= community.description %></p>
<p><strong>Owner:</strong> <%= community.owner.username %></p>

<h3>Members:</h3>
<ul>
  <% community.members.forEach(member => { %>
    <li><%= member.username %></li>
  <% }) %>
</ul>

<% if (isOwner) { %>
  <p><a href="/communities/<%= community._id %>/edit">Edit this community</a></p>
<% } %>

<% if (community.owner._id.toString() !== user._id.toString()) { %>
  <% const isMember = community.members.some(m => m._id.toString() === user._id.toString()); %>
  
  <form action="/communities/<%= community._id %>/<%= isMember ? 'leave' : 'join' %>" method="POST">
    <button type="submit">
      <%= isMember ? "Leave Community" : "Join Community" %>
    </button>
  </form>
<% } %>

<% if (community.members.some(m => m._id.toString() === user._id.toString())) { %>
  <form action="/communities/<%= community._id %>/invite" method="POST">
    <label for="friendId">Invite a friend:</label>
    <select name="friendId" id="friendId">
      <% friends.forEach(friend => { %>
        <% const alreadyMember = community.members.some(m => m._id.toString() === friend._id.toString()); %>
        <% if (!alreadyMember) { %>
          <option value="<%= friend._id %>"><%= friend.username %></option>
        <% } %>
      <% }) %>
    </select>
    <button type="submit">Send Invite</button>
  </form>
<% } %>

<p><a href="/communities">‚Üê Back to My Communities</a></p>
